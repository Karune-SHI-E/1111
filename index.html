<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>å‹ç¼©åŒ…å¯†ç æŸ¥è¯¢</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
<style>
body { font-family: Arial, sans-serif; padding: 20px; background: #121212; color: #e0e0e0; }
input, button { padding: 8px; margin: 5px 0; font-size: 16px; }
button { cursor: pointer; }
#result { margin-top: 15px; }
</style>
</head>
<body>
<h2>ğŸ”‘ å‹ç¼©åŒ…å¯†ç æŸ¥è¯¢</h2>
<input type="text" id="md5-input" placeholder="è¾“å…¥æ–‡ä»¶ MD5" size="35"/>
<button id="query-btn">æŸ¥è¯¢å¯†ç </button>
<div id="result"></div>

<script>
const MD5_REGEX = /^[a-fA-F0-9]{32}$/;
const queryBtn = document.getElementById('query-btn');
const md5Input = document.getElementById('md5-input');
const resultDiv = document.getElementById('result');

// GitHub raw URL
const GITHUB_URL = 'https://raw.githubusercontent.com/Karune-SHI-E/1111/master/passwords_local.json.gz';
// è‡ªå»ºæœåŠ¡å™¨ URLï¼ˆå›é€€ç”¨ï¼‰
const SERVER_URL = 'http://127.0.0.1:5000'; // æ›¿æ¢ä¸ºå…¬ç½‘å¯è®¿é—®åœ°å€

queryBtn.addEventListener('click', async () => {
    const md5 = md5Input.value.trim();
    if (!MD5_REGEX.test(md5)) {
        resultDiv.textContent = "âŒ MD5æ ¼å¼ä¸æ­£ç¡®";
        return;
    }

    resultDiv.textContent = "ğŸ” æŸ¥è¯¢ä¸­...";

    try {
        let password = null;

        // ---------------- GitHub æŸ¥è¯¢ ----------------
        try {
            // å¦‚æœ raw è¢« CORS é™åˆ¶ï¼Œå¯ä½¿ç”¨ç®€å•ä»£ç†ï¼ˆå¯é€‰ï¼‰
            // const resp = await fetch('https://cors-anywhere.herokuapp.com/' + GITHUB_URL);
            const resp = await fetch(GITHUB_URL);
            if (resp.ok) {
                const compressed = await resp.arrayBuffer();
                const decompressed = pako.inflate(new Uint8Array(compressed), { to: 'string' });
                const data = JSON.parse(decompressed);

                // data æ˜¯æ•°ç»„ [[md5, password], ...]
                const entry = data.find(e => e[0].toLowerCase() === md5.toLowerCase());
                if (entry) password = entry[1];
            }
        } catch (e) {
            console.warn("GitHub æŸ¥è¯¢å¤±è´¥ï¼Œå°è¯•æœåŠ¡å™¨å›é€€", e);
        }

        // ---------------- æœåŠ¡å™¨æŸ¥è¯¢ ----------------
        if (!password) {
            try {
                const resp2 = await fetch(`${SERVER_URL}/query/${md5}?user_id=YOUR_ID`);
                if (resp2.ok) {
                    const j = await resp2.json();
                    if (j.password) password = j.password;
                }
            } catch (e) {
                console.warn("æœåŠ¡å™¨æŸ¥è¯¢å¤±è´¥", e);
            }
        }

        // ---------------- ç»“æœæ˜¾ç¤º ----------------
        if (password) {
            resultDiv.textContent = `ğŸ”‘ å¯†ç : ${password}`;
        } else {
            resultDiv.textContent = "âŒ æœªæ‰¾åˆ°å¯†ç ";
        }

    } catch (e) {
        console.error(e);
        resultDiv.textContent = "âŒ æŸ¥è¯¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ";
    }
});
</script>
</body>
</html>
